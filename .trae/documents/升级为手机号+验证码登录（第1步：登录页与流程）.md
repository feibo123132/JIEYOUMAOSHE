## 目标与范围
- 将匿名登录升级为“手机号+验证码”登录，并为后续云函数校验做准备。
- 本次交付聚焦第1步：建立登录页 UI、交互与前端调用流程（不修改后端真实数据）。

## 页面与路由
- 新增路由：`/login`
- 页面文件：`src/pages/Login/index.tsx`
- 入口导航：在导航栏“我的/商店”等仍保留，未登录访问受守卫控制：跳转到 `/login`

## 登录页 UI 要素
- 手机号输入框（支持大陆 11 位手机号，前端校验）
- 获取验证码按钮（点击后触发云函数“发送验证码”，按钮进入 60s 倒计时，禁用重复发送）
- 验证码输入框（6 位数字）
- 登录/注册按钮（调用云函数“校验并登录”）
- 反馈：错误提示（手机号格式、验证码错误、网络异常）、成功后跳转首页

## 前端状态与交互（不改后端）
- 组件本地状态：`phone`、`code`、`countdown`、`loading`、`errorMsg`
- 计时器：点击获取验证码 → `countdown=60`，每秒递减，至 0 恢复按钮可用
- 云函数调用形态（约定）：
  - `tcb.callFunction({ name: 'login', data: { action: 'send', phone } })`
  - `tcb.callFunction({ name: 'login', data: { action: 'verify', phone, code } })`
- 成功后：写本地登录态占位（例如 `localStorage.setItem('tcb_auth', uid)`），并通知 `AppContext` 刷新用户数据。

## 路由守卫（前端）
- 在 `AppContext` 增加方法 `isAuthed()`：检查本地是否有登录态占位（如 `tcb_auth`）
- 在 `App.tsx` 或导航点击时，若未登录则 `navigate('/login')`
- 也可在受保护页面（`/shop`、`/profile`）页头加入守卫：未登录则重定向 `/login`

## 组件骨架代码（示例说明，不做实际写入）
```tsx
// src/pages/Login/index.tsx（示意）
export default function Login() {
  const [phone, setPhone] = useState('')
  const [code, setCode] = useState('')
  const [countdown, setCountdown] = useState(0)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState('')

  const sendCode = async () => {
    if (!/^1\d{10}$/.test(phone)) { setError('手机号格式不正确'); return }
    setError(''); setLoading(true)
    try {
      await tcb.callFunction({ name: 'login', data: { action: 'send', phone } })
      setCountdown(60)
    } catch (e) { setError('验证码发送失败'); }
    finally { setLoading(false) }
  }

  useEffect(() => {
    if (countdown > 0) {
      const timer = setTimeout(() => setCountdown(countdown - 1), 1000)
      return () => clearTimeout(timer)
    }
  }, [countdown])

  const doLogin = async () => {
    if (!/^\d{6}$/.test(code)) { setError('验证码格式不正确'); return }
    setError(''); setLoading(true)
    try {
      const res = await tcb.callFunction({ name: 'login', data: { action: 'verify', phone, code } })
      const uid = res?.result?.uid
      if (!uid) throw new Error('登录失败')
      localStorage.setItem('tcb_auth', uid)
      navigate('/')
    } catch (e) { setError('验证码校验失败'); }
    finally { setLoading(false) }
  }

  return (<div>{/* 输入框、按钮与反馈 */}</div>)
}
```

## 云函数约定（为后续步骤准备）
- 目录建议：`cloudfunctions/login/index.js`
- 接口：
  - `action='send'`：向手机号发送验证码（短信通道）
  - `action='verify'`：校验验证码，调用 `auth.signInWithPhone(phone, code)`，返回 `uid`
- 前端不直接调用 `auth.signInWithPhone`，而是调用云函数，以便真实安全校验与风控。

## AppContext 初始化调整（占位方案）
- 原匿名登录保留作为“未配置云函数时”的降级（可选）
- 初始化流程：
  1) 检查 `localStorage.tcb_auth`；如有 `uid`，走用户加载流程；如无，仍渲染应用但受守卫控制
  2) 交互页面若发现未登录，跳转到 `/login`

## Actions 与环境变量
- 保持现有 `VITE_CLOUDBASE_ENV_ID`、`VITE_CLOUDBASE_REGION`
- 云函数所需短信/验证码配置在腾讯云开发后台完成（后续步骤）

## 验证清单
- 访问 `/login` → 发送验证码 → 60s 倒计时 → 输入验证码 → 登录成功跳转首页
- 未登录直接访问 `/profile` 或 `/shop` → 自动跳转 `/login`

如果你确认这个方案，我将开始写入第1步的页面文件和路由守卫代码（不改后端），随后按你的第二步要求接入云函数。