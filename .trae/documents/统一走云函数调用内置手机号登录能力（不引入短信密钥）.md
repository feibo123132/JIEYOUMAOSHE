## 可行性评估
- 你的方案目标：在云函数中使用 CloudBase Node-SDK 的内置手机号登录能力（与前端 JS SDK等价），避免自建短信通道与密钥。
- 风险与兼容：部分环境或 Node-SDK 版本可能不提供 `sendSmsCode/signInWithPhone`；因此需加入能力探测与回退（明确错误码），前端仍按 `callFunction('login')` 调用。

## 改造内容
### 1. 云函数 `login/index.js`
- 初始化：`const app = cloudbase.init({ env: ENV_ID }) ; const auth = app.auth()`
- 分支 `action: 'send'`
  - 能力探测：如果 `auth.sendSmsCode` 或 `auth.sendPhoneCode` 存在 → 直接调用发送验证码并返回 `{ok:true, requestId}`
  - 不存在 → 返回 `{error:'api_unavailable', message:'CloudBase 未提供手机号验证码发送 API'}`
- 分支 `action: 'verify'`
  - 能力探测：如果 `auth.signInWithPhone` 或 `auth.signInWithPhoneCode` 存在 → 调用完成登录，返回 `{uid}`
  - 不存在 → 返回 `{error:'api_unavailable', message:'CloudBase 未提供手机号验证码登录 API'}`
- 日志：打印 `code/message`，便于排障；不引入 `tencentcloud-sdk-nodejs`；不需要任何密钥环境变量。

### 2. 前端服务层 `src/services/cloudbase.ts`
- 保留 `sendCode/verifyCode` 通过 `callFunction({ name:'login' })` 调用，不再直调 JS SDK。
- 在 `sendCode`/`verifyCode` 接收到 `{error:'api_unavailable'}` 时，向登录页提示“请在控制台开启手机号登录”。
- `ensureLogin` 保持匿名认证与持久化，确保云函数调用不再出现“未认证”。

### 3. 登录页 `src/pages/Login.tsx`
- “获取验证码”调用 `sendCode(phone)`，读取 `requestId`（如有）并倒计时。
- “登录/注册”调用 `verifyCode(phone, code)`；成功后写入 `tcb_auth`，拉取用户并跳转首页；失败显示云函数返回的 `message`。

## 交付
- 我将提供完整的云函数 `index.js` 最终版本与 `package.json`；前端保持现在的 `sendCode/verifyCode` 接口但改为使用云函数。
- 不需要在云函数中配置任何密钥；只需保持 CloudBase 控制台开启手机号登录能力。

## 验证
- 控制台“日志”应出现 `send/verify` 的调用记录；前端倒计时正常；
- 若能力未开启：登录页提示“请在控制台开启手机号登录”；能力开启后实际下发短信并可登录。